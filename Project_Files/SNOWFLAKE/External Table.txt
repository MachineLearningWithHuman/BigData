SHOW STAGES;

CREATE OR REPLACE EXTERNAL TABLE CASE
(
  ACCOUNT_ID VARCHAR AS (VALUE:c1::VARCHAR),
  ACCOUNT_NAME VARCHAR AS (VALUE:c2::VARCHAR),
  ACCOUNT_RATING NUMERIC AS (VALUE:c3::NUMERIC),
  ACCOUNT_TYPE VARCHAR AS (VALUE:c4::VARCHAR),
  ACTIVE VARCHAR AS (VALUE:c5::VARCHAR),
  ALIAS VARCHAR AS (VALUE:c6::VARCHAR),
  APPLICATION VARCHAR AS (VALUE:c7::VARCHAR),
  BILLING_COUNTRY VARCHAR AS (VALUE:c8::VARCHAR),
  BILLING_STREET VARCHAR AS (VALUE:c9::VARCHAR),
  BILLING_ZIP_POSTAL_CODE VARCHAR AS (VALUE:c10::VARCHAR),
  CLOSE_DATE VARCHAR AS (VALUE:c11::VARCHAR),
  CLOSED VARCHAR AS (VALUE:c12::VARCHAR),
  CLOSED_LOST_REASON VARCHAR AS (VALUE:c13::VARCHAR),
  CONTACT_ID VARCHAR AS (VALUE:c14::VARCHAR),
  CREATED_BY_ID VARCHAR AS (VALUE:c15::VARCHAR),
  CREATED_BY_LEAD_CONVERSION VARCHAR AS (VALUE:c16::VARCHAR),
  CREATED_DATE VARCHAR AS (VALUE:c17::VARCHAR),
  DEPARTMENT VARCHAR AS (VALUE:c18::VARCHAR),
  DIVISION VARCHAR AS (VALUE:c19::VARCHAR),
  FORECAST_CATEGORY VARCHAR AS (VALUE:c20::VARCHAR),
  ID VARCHAR AS (VALUE:c21::VARCHAR),
  INDUSTRY VARCHAR AS (VALUE:c22::VARCHAR),
  INDUSTRY_SUBSEGMENT VARCHAR AS (VALUE:c23::VARCHAR),
  IS_ACTIVE VARCHAR AS (VALUE:c24::VARCHAR),
  LAST_MODIFIED_BY_ID VARCHAR AS (VALUE:c25::VARCHAR),
  LAST_MODIFIED_DATE VARCHAR AS (VALUE:c26::VARCHAR),
  LAST_ACTIVITY_DATE VARCHAR AS (VALUE:c27::VARCHAR),
  LEAD_SOURCE VARCHAR AS (VALUE:c28::VARCHAR),
  LEAD_TYPE VARCHAR AS (VALUE:c29::VARCHAR),
  MANAGER_ID VARCHAR AS (VALUE:c30::VARCHAR),
  MASS_SPEC_MANUFACTURER VARCHAR AS (VALUE:c31::VARCHAR),
  NAME VARCHAR AS (VALUE:c32::VARCHAR),
  OWNER_ID VARCHAR AS (VALUE:c33::VARCHAR),
  PARENT_ACCOUNT_ID VARCHAR AS (VALUE:c34::VARCHAR),
  PRIMARY_APPLICATION VARCHAR AS (VALUE:c35::VARCHAR),
  PRODUCT_CATEGORY VARCHAR AS (VALUE:c36::VARCHAR),
  PRODUCT_OF_INTEREST VARCHAR AS (VALUE:c37::VARCHAR),
  PROFILE_ID VARCHAR AS (VALUE:c38::VARCHAR),
  RECORD_TYPE_ID VARCHAR AS (VALUE:c39::VARCHAR),
  SERIAL_NUMBER VARCHAR AS (VALUE:c40::VARCHAR),
  SHIPPING_COUNTRY VARCHAR AS (VALUE:c41::VARCHAR),
  SHIPPING_STREET VARCHAR AS (VALUE:c42::VARCHAR),
  SHIPPING_ZIP_POSTAL_CODE VARCHAR AS (VALUE:c43::VARCHAR),
  STANDARD_APPLICATION VARCHAR AS (VALUE:c44::VARCHAR),
  STATE VARCHAR AS (VALUE:c45::VARCHAR),
  SUBSEGMENT VARCHAR AS (VALUE:c46::VARCHAR),
  TECHNICAL_OWNER VARCHAR AS (VALUE:c47::VARCHAR),
  TITLE VARCHAR AS (VALUE:c48::VARCHAR),
  USER_ID VARCHAR AS (VALUE:c49::VARCHAR),
  USER_ROLE_ID VARCHAR AS (VALUE:c50::VARCHAR),
  USER_TYPE VARCHAR AS (VALUE:c51::VARCHAR),
  CASE_ID VARCHAR AS (VALUE:c52::VARCHAR),
  //CALL_CENTER_ID VARCHAR AS (VALUE:c53::VARCHAR),
  CASE_NUMBER NUMERIC AS (VALUE:c54::NUMERIC),
  CASE_ORIGIN VARCHAR AS (VALUE:c55::VARCHAR),
  CASE_TYPE VARCHAR AS (VALUE:c56::VARCHAR),
  COMMUNITY_NICK_NAME VARCHAR AS (VALUE:c57::VARCHAR),
  COMPANY_NAME VARCHAR AS (VALUE:c58::VARCHAR),
  END_USER_UPDATE VARCHAR AS (VALUE:c59::VARCHAR),
  FLOW_USER VARCHAR AS (VALUE:c60::VARCHAR),
  FORECAST_ENABLED VARCHAR AS (VALUE:c61::VARCHAR),
  FULL_NAME VARCHAR AS (VALUE:c62::VARCHAR),
  INITIALLY_ASSIGNED_AT VARCHAR AS (VALUE:c63::VARCHAR),
  IS_DEMO_CENTER VARCHAR AS (VALUE:c64::VARCHAR),
  IS_CREATED VARCHAR AS (VALUE:c65::VARCHAR),
  IS_DELETED VARCHAR AS (VALUE:c66::VARCHAR),
  KEY_ACCOUNT VARCHAR AS (VALUE:c67::VARCHAR),
  LAST_NAME VARCHAR AS (VALUE:c68::VARCHAR),
  LIFE_SCIENCE_KEY_ACCOUNT VARCHAR AS (VALUE:c69::VARCHAR),
  LIGHTNING_EXPERIENCE_PERFERRED VARCHAR AS (VALUE:c70::VARCHAR),
  MAILING_COUNTRY VARCHAR AS (VALUE:c71::VARCHAR),
  MAILING_STREET VARCHAR AS (VALUE:c72::VARCHAR),
  MAILING_POSTAL_CODE VARCHAR AS (VALUE:c73::VARCHAR),
  MARKETING_USER VARCHAR AS (VALUE:c74::VARCHAR),
  OFFLINE_USER VARCHAR AS (VALUE:c75::VARCHAR),
  PARDOT_CAMPAIGN VARCHAR AS (VALUE:c76::VARCHAR),
  PARDOT_CONVERSION_DATE VARCHAR AS (VALUE:c77::VARCHAR),
  PARDOT_CONVERSION_OBJECT_NAME VARCHAR AS (VALUE:c78::VARCHAR),
  PARDOT_CONVERSION_OBJECT_TYPE VARCHAR AS (VALUE:c79::VARCHAR),
  PARDOT_CREATED_DATE VARCHAR AS (VALUE:c80::VARCHAR),
  PARDOT_FIRST_ACTIVITY VARCHAR AS (VALUE:c81::VARCHAR),
  PARDOT_LAST_ACTIVITY VARCHAR AS (VALUE:c82::VARCHAR),
  PARDOT_USER_ROLE VARCHAR AS (VALUE:c83::VARCHAR),
  STATUS VARCHAR AS (VALUE:c84::VARCHAR),
  TICKET_ASSIGNEE_NAME VARCHAR AS (VALUE:c85::VARCHAR),
  TICKET_CREATED_AT VARCHAR AS (VALUE:c86::VARCHAR),
  TICKET_GROUP_NAME VARCHAR AS (VALUE:c87::VARCHAR),
  TICKET_ID VARCHAR AS (VALUE:c88::VARCHAR),
  TICKET_INITIALLY_ASSIGNED VARCHAR AS (VALUE:c89::VARCHAR),
  TICKET_ORGANIZATION_NAME VARCHAR AS (VALUE:c90::VARCHAR),
  TICKET_REQUESTER_EMAIL VARCHAR AS (VALUE:c91::VARCHAR),
  TICKET_REQUESTER_NAME VARCHAR AS (VALUE:c92::VARCHAR),
  TICKET_SOLVED_AT VARCHAR AS (VALUE:c93::VARCHAR),
  TICKET_UPDATED_AT VARCHAR AS (VALUE:c94::VARCHAR),
  LEAD_SCORE VARCHAR AS (VALUE:c95::VARCHAR),
  PARDOT_SCORE VARCHAR AS (VALUE:c96::VARCHAR),
  AGENT_WAIT_TIME VARCHAR AS (VALUE:c97::VARCHAR),
  REQUESTER_WAIT_TIME VARCHAR AS (VALUE:c98::VARCHAR),
  TICKET_RESOLUTION VARCHAR AS (VALUE:c99::VARCHAR)  
)
WITH LOCATION = @CASE_AWS_STAGE
PATTERN = '.*.csv'
AUTO_REFRESH = TRUE
FILE_FORMAT = OPPORTUNITY_FILE;

//select DISTINCT(CALL_CENTER_ID) from case;

//MATERIALIZED VIEW IN TOP OF THE CASE

create or replace materialized view DEVELOPMENT.OPERATION.OPEN_MATERIALIZED_VIEW(
	VALUE,
	ACCOUNT_ID,
	ACCOUNT_NAME,
	ACCOUNT_RATING,
	ACCOUNT_TYPE,
	ACTIVE,
	ALIAS,
	APPLICATION,
	BILLING_COUNTRY,
	BILLING_STREET,
	BILLING_ZIP_POSTAL_CODE,
	CLOSE_DATE,
	CLOSED,
	CLOSED_LOST_REASON,
	CONTACT_ID,
	CREATED_BY_ID,
	CREATED_BY_LEAD_CONVERSION,
	CREATED_DATE,
	DEPARTMENT,
	DIVISION,
	FORECAST_CATEGORY,
	ID,
	INDUSTRY,
	INDUSTRY_SUBSEGMENT,
	IS_ACTIVE,
	LAST_MODIFIED_BY_ID,
	LAST_MODIFIED_DATE,
	LAST_ACTIVITY_DATE,
	LEAD_SOURCE,
	LEAD_TYPE,
	MANAGER_ID,
	MASS_SPEC_MANUFACTURER,
	NAME,
	OWNER_ID,
	PARENT_ACCOUNT_ID,
	PRIMARY_APPLICATION,
	PRODUCT_CATEGORY,
	PRODUCT_OF_INTEREST,
	PROFILE_ID,
	RECORD_TYPE_ID,
	SERIAL_NUMBER,
	SHIPPING_COUNTRY,
	SHIPPING_STREET,
	SHIPPING_ZIP_POSTAL_CODE,
	STANDARD_APPLICATION,
	STATE,
	SUBSEGMENT,
	TECHNICAL_OWNER,
	TITLE,
	USER_ID,
	USER_ROLE_ID,
	USER_TYPE,
	CASE_ID,
	CASE_NUMBER,
	CASE_ORIGIN,
	CASE_TYPE,
	COMMUNITY_NICK_NAME,
	COMPANY_NAME,
	END_USER_UPDATE,
	FLOW_USER,
	FORECAST_ENABLED,
	FULL_NAME,
	INITIALLY_ASSIGNED_AT,
	IS_DEMO_CENTER,
	IS_CREATED,
	IS_DELETED,
	KEY_ACCOUNT,
	LAST_NAME,
	LIFE_SCIENCE_KEY_ACCOUNT,
	LIGHTNING_EXPERIENCE_PERFERRED,
	MAILING_COUNTRY,
	MAILING_STREET,
	MAILING_POSTAL_CODE,
	MARKETING_USER,
	OFFLINE_USER,
	PARDOT_CAMPAIGN,
	PARDOT_CONVERSION_DATE,
	PARDOT_CONVERSION_OBJECT_NAME,
	PARDOT_CONVERSION_OBJECT_TYPE,
	PARDOT_CREATED_DATE,
	PARDOT_FIRST_ACTIVITY,
	PARDOT_LAST_ACTIVITY,
	PARDOT_USER_ROLE,
	STATUS,
	TICKET_ASSIGNEE_NAME,
	TICKET_CREATED_AT,
	TICKET_GROUP_NAME,
	TICKET_ID,
	TICKET_INITIALLY_ASSIGNED,
	TICKET_ORGANIZATION_NAME,
	TICKET_REQUESTER_EMAIL,
	TICKET_REQUESTER_NAME,
	TICKET_SOLVED_AT,
	TICKET_UPDATED_AT,
	LEAD_SCORE,
	PARDOT_SCORE,
	AGENT_WAIT_TIME,
	REQUESTER_WAIT_TIME,
	TICKET_RESOLUTION
) as
SELECT * FROM CASE WHERE STATUS='Open';
